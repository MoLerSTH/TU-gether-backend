<!-- app/templates/me_registrations.html -->

{% extends "main.html" %}

{% block title %}History{% endblock %}



{% block body_container %}



<style>

  /* ‡∏ã‡πà‡∏≠‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏Ç‡∏≠‡∏á main.html */

  .background {

    display: none !important;

  }



  /* ===== Modern Modal (shared & polished) ‚Äì unified with detail.html ===== */



  /* ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏™‡∏µ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÇ‡∏°‡∏î‡∏±‡∏• */

  :root {

    --m-backdrop: rgba(9, 12, 20, .55);

    --m-card: #ffffff;

    --m-text: #0f172a;

    --m-muted: #64748b;

    --m-success: #16a34a;

    --m-error: #dc2626;

    --m-info: #2563eb;

    --m-warn: #d97706;

    --m-ring: rgba(37, 99, 235, .25);

  }



  @media (prefers-color-scheme: dark) {

    :root {

      --m-backdrop: rgba(0, 0, 0, .55);

      --m-card: #0f172a;

      --m-text: #e5e7eb;

      --m-muted: #94a3b8;

      --m-ring: rgba(59, 130, 246, .35);

    }

  }



  /* ‡∏õ‡∏¥‡∏î‡∏™‡∏Å‡∏≠‡∏£‡πå‡∏•‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ç‡∏∂‡πâ‡∏ô‡πÇ‡∏°‡∏î‡∏±‡∏• */

  body.no-scroll {

    overflow: hidden;

  }



  /* ‡∏â‡∏≤‡∏Å‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏°‡∏î‡∏±‡∏• */

  .modal-backdrop {

    position: fixed;

    inset: 0;

    background: var(--m-backdrop);

    backdrop-filter: blur(2px);

    -webkit-backdrop-filter: blur(2px);

    opacity: 0;

    pointer-events: none;

    transition: opacity .2s ease;

    z-index: 20000;

  }



  .modal-backdrop.show {

    opacity: 1;

    pointer-events: auto;

  }



  /* ‡πÇ‡∏Æ‡∏™‡∏ï‡πå‡πÇ‡∏°‡∏î‡∏±‡∏• */

  .modal {

    position: fixed;

    inset: 0;

    display: grid;

    place-items: center;

    z-index: 20001;

    pointer-events: none;

    padding: 16px;

  }



  .modal.open {

    pointer-events: auto;

  }



  /* ‡∏Å‡∏•‡πà‡∏≠‡∏á‡πÇ‡∏°‡∏î‡∏±‡∏• + ‡∏ó‡∏£‡∏≤‡∏ô‡∏ã‡∏¥‡∏ä‡∏±‡∏ô‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÉ‡∏ô detail.html */

  .modal-card {

    width: min(92vw, 520px);

    background: var(--m-card);

    color: var(--m-text);

    border-radius: 18px;

    border: 1px solid rgba(148, 163, 184, .25);

    box-shadow: 0 24px 60px rgba(0, 0, 0, .28);

    transform: translateY(16px) scale(.98);

    opacity: 0;

    transition: transform .2s ease, opacity .2s ease;

    outline: none;

  }



  .modal.open .modal-card {

    transform: translateY(0) scale(1);

    opacity: 1;

  }



  /* ‡∏™‡πà‡∏ß‡∏ô‡∏´‡∏±‡∏ß/‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô/‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤/‡πÅ‡∏≠‡πá‡∏Å‡∏ä‡∏±‡∏ô */

  .modal-header {

    display: flex;

    align-items: center;

    gap: 12px;

    padding: 16px 18px 10px 18px;

    border-bottom: 1px dashed rgba(148, 163, 184, .25);

  }



  .modal-icon {

    width: 36px;

    height: 36px;

    flex: 0 0 36px;

    display: grid;

    place-items: center;

    border-radius: 999px;

    background: var(--brand-200);

    color: var(--brand-600);

    font-weight: 900;

  }



  .modal-title {

    font-weight: 700;

    font-size: 1.05rem;

    letter-spacing: .2px;

  }



  .modal-body {

    padding: 14px 18px 6px 18px;

    color: var(--m-muted);

    line-height: 1.65;

  }



  .modal-body p {

    margin: 0;

  }



  .modal-actions {

    padding: 14px 16px 18px;

    display: flex;

    gap: 10px;

    justify-content: flex-end;

  }



  /* ‡∏õ‡∏∏‡πà‡∏° */

  .modal-btn {

    padding: 10px 14px;

    border-radius: 12px;

    border: 1px solid rgba(148, 163, 184, .35);

    background: #fff;

    color: #0f172a;

    cursor: pointer;

    font-weight: 600;

    transition: box-shadow .15s ease, transform .1s ease, background .2s ease;

  }



  .modal-btn:hover {

    transform: translateY(-1px);

    box-shadow: 0 8px 22px rgba(0, 0, 0, .12);

  }



  .modal-btn:focus {

    outline: none;

    box-shadow: 0 0 0 4px var(--m-ring);

  }



  .modal-btn.primary {

    background: linear-gradient(180deg, #d32f2f 0%, #b71c1c 100%);

    color: #fff;

    border-color: transparent;

    box-shadow: 0 8px 22px rgba(211, 47, 47, .25);

  }



  @media (prefers-color-scheme: dark) {

    .modal-card {

      border-color: rgba(35, 42, 59, .9);

      box-shadow: 0 24px 60px rgba(0, 0, 0, .55);

    }



    .modal-header {

      border-bottom-color: rgba(35, 42, 59, .9);

    }



    .modal-body {

      color: #d1d5db;

    }



    .modal-btn {

      background: #0b1220;

      color: #e5e7eb;

      border-color: #232a3b;

    }



    .modal-btn.primary {

      background: linear-gradient(180deg, #d32f2f 0%, #b71c1c 100%);

    }

  }



  /* ‡∏™‡∏µ‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ */

  .modal-card.success .modal-icon {

    background: #e6f8ec;

    color: #137a2c;

  }



  .modal-card.error .modal-icon {

    background: #fde2e2;

    color: #b71c1c;

  }



  .modal-card.warn .modal-icon {

    background: #fff5e0;

    color: #a76100;

  }



  .modal-card.info .modal-icon {

    background: #e7f0ff;

    color: #144aa0;

  }

</style>



<main id="history-root" class="ml-[260px] transition-all duration-200 min-h-screen bg-gray-100 font-inter p-8">

  <div class="max-w-6xl mx-auto">

    <h1 class="text-2xl font-bold text-gray-900 mb-6">Event History</h1>



    <!-- Search & Filter Row -->

    <div class="flex flex-wrap gap-3 items-center mb-6">

      <input id="search-text" type="text" placeholder="Search title..."

        class="border border-gray-300 rounded-lg px-4 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">



      <select id="status-filter"

        class="border border-gray-300 rounded-lg px-4 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">

        <option value="">All statuses</option>

        <option value="confirmed">Registered</option>

        <option value="Cancelled">Cancelled</option>

        <option value="Attended">Attended</option>

      </select>



      <button id="reload-btn"

        class="bg-white border border-gray-300 rounded-lg px-4 py-2 text-sm hover:opacity-80 transition">

        Reload

      </button>

    </div>



    <!-- List Grid -->

    <div id="list" class="flex flex-col gap-5"></div>





    <!-- Card Template -->

    <template id="card-tpl">

      <div

        class="w-full flex flex-col md:flex-row items-start md:items-center justify-between bg-white rounded-2xl shadow-md hover:shadow-lg transition-transform hover:-translate-y-1 overflow-hidden border border-gray-100 mb-5">



        <!-- ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° -->

        <img data-field="picture" alt=""

          class="w-full md:w-48 h-48 md:h-32 object-cover border-b-4 md:border-b-0 md:border-r-4 border-red-600">



        <!-- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° -->

        <div class="flex-1 px-6 py-4">

          <div data-field="title" class="text-lg font-semibold text-gray-900 mb-2"></div>



          <div class="flex items-center gap-2 text-gray-700 text-sm mb-1">

            <i class='bx bx-calendar text-red-600'></i>

            <span>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏±‡∏î‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°:</span>

            <strong data-field="meta"></strong>

          </div>



          <div class="flex items-center gap-2 text-gray-700 text-sm mb-1">

            <i class='bx bx-time text-red-600'></i>

            <span>‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô:</span>

            <strong data-field="registered"></strong>

          </div>



          <div class="flex items-center gap-2 text-gray-700 text-sm mb-1">

            <i class='bx bx-check-square text-red-600'></i>

            <span>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏¥‡∏à‡∏à‡∏Å‡∏£‡∏£‡∏°/‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ:</span>

            <div data-field="badges" class="flex flex-wrap items-center gap-1"></div>

          </div>





        </div>



        <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏î‡πâ‡∏≤‡∏ô‡∏Ç‡∏ß‡∏≤ -->

        <div

          class="flex md:flex-col flex-row justify-between md:items-end items-center gap-3 md:pl-5 border-t md:border-t-0 md:border-l border-gray-200 w-full md:w-auto px-5 py-3 md:py-0">

          <button data-action="cancel"

            class="flex items-center gap-2 bg-red-600 text-white font-medium text-sm px-3 py-1.5 rounded-lg hover:bg-red-700 transition">

            <i class='bx bx-x-circle text-base'></i> CANCEL

          </button>



        </div>

      </div>

    </template>



  </div>

</main>



<script>



  // Auth + Admin

  (async () => {

    try {

      const r = await fetch("/api/auth/me");

      if (r.ok) {

        const me = await r.json();

        const el = document.getElementById("user-name");

        if (el && me.display_name) el.textContent = `üë§ ${me.display_name}`;

        if (me.role === "admin") {

          const fab = document.getElementById("fab-admin");

          if (fab) fab.classList.add("show");

        }

      }

    } catch { }

  })();



  // ‡∏õ‡∏£‡∏±‡∏ö margin-left ‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ sidebar

  (function syncSidebarMargin() {

    const root = document.getElementById('history-root');

    const body = document.querySelector('body');

    const sidebar = body.querySelector('.sidebar');

    const toggle = body.querySelector('.toggle');



    function apply() {

      const isClose = sidebar.classList.contains('close');

      root.classList.remove('ml-[260px]', 'ml-[88px]');

      root.classList.add(isClose ? 'ml-[88px]' : 'ml-[260px]');

    }

    apply();

    if (toggle) toggle.addEventListener('click', () => setTimeout(apply, 0));

    window.addEventListener('storage', e => { if (e.key === 'sidebar') apply(); });

  })();



  const body = document.querySelector("body"),

    sidebar = body.querySelector(".sidebar"),

    toggle = body.querySelector(".toggle");

  if (localStorage.getItem("sidebar") === "open") sidebar.classList.remove("close");

  else sidebar.classList.add("close");

  toggle.addEventListener("click", () => {

    sidebar.classList.toggle("close");

    localStorage.setItem("sidebar", sidebar.classList.contains("close") ? "close" : "open");

  });

</script>



<script src="/static/js/me_registrations.js"></script>

{% endblock %}